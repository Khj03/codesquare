<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>알림</title>

<script	src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.3.0/sockjs.min.js"></script>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"
	integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	crossorigin="anonymous"></script>

<script	src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
</head>

<body>
	<h1>으뱌뱌요 알림테스트</h1>

	<input type="text" id="message">
	<button id="btnSend">메세지 전송</button>
	<p id="result">p입니다.</p>


	<!-- <p th:text="${board.nickname} + '님의 게시물에 댓글이 달렸습니다'"></p> -->

	<script>
		//SockJS 코드
		$(document).ready(function() {
			//connectSockJS();
			connectStomp();
		});

		//스톰
		var socket = null;
		var isStomp = false;
		function connectStomp() {
			var sock = new SockJS("/stompTest"); // endpoint
			var client = Stomp.over(sock);
			isStomp = true;
			socket = client;

			client.connect({}, function() {
				console.log("Connected stompTest!");
				// Controller's MessageMapping, header, message(자유형식)
				client.send('/TTT', {}, "msg: Haha~~~");
				// 해당 토픽을 구독한다!
				client.subscribe('/topic/message', function(event) {
					console.log("!!!!!!!!!!!!event>>", event)
				});
			});
		}

		function connectSockJS() {
			console.log("eeeee")
			var sock = new SockJS("/notice");
			socket = sock;

			sock.onopen = function() {
				console.log('Info: connection opened.');
				sock.send("hi~");

				sock.onmessage = function(event) {
					console.log("ReceivedMessage:", event.data);
				};

				sock.onclose = function(event) {
					console.log('Info: connection closed.');
				};
			};
		}
	</script>


	<!-- <script>
		//순수 웹소켓 코드
		var socket = null;
		
		connectWS();

		function connectWS() {
			var ws = new WebSocket("ws://echo.websocket.org");
			console.log("connectWS start");
			//var ws = new WebSocket("ws://localhost:8080/notice");
			console.log("connectWS start ok");
			//변경사항: ws://localhost:8080/notice 로 경로했을때 소켓이 안열림
			socket = ws;
			ws.onopen = function onopen() {
				console.log("소켓이 열렸읍니다.");
			}

			/* 		일단 패스
			 function a() {
			 ws.send("회원님의 게시글에 댓글이 달렸습니다.");
			 };
			 */

			//서버에서 송신한 메세지를 클라이언트가 수신하는 콜백함수 _4
			ws.onmessage = function(msg) {
				ws.send(msg);
				document.getElementById("result").innerHTML = "댓글이달렸습니다"
						+ "<br>";

			}
		};
		socket.onClose = function(event) {
			console.log('Info: connection closed.');

		};

		socket.onError = function(err) {
			console.log('Error:', err);
		};
	</script> -->

</body>

</html>
